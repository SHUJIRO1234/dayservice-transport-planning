# デイサービス送迎計画アプリ - 使い方ガイド

## 概要

このアプリケーションは、デイサービスの送迎業務を効率化するために開発されたWebアプリケーションです。利用者の住所を地図上に表示し、最適な巡回ルートを自動計算することで、送迎時間の短縮と業務効率化を実現します。

## 主な機能

### 1. 本日の送迎対象者一覧

アプリを開くと、本日の送迎対象者が一覧表示されます。各利用者について以下の情報が表示されます：

- **氏名**
- **住所**
- **送迎時刻・帰宅時刻**
- **車椅子対応の有無**（紫色のバッジで表示）
- **備考**（介助が必要な場合など）

### 2. サマリー情報

画面上部には、以下のサマリー情報が表示されます：

- **本日の送迎対象者**: 送迎が必要な利用者の総数
- **車椅子対応**: 車椅子対応が必要な利用者数
- **利用可能車両**: 送迎に使用できる車両の台数

### 3. 地図表示機能

**「地図で表示」ボタン**をクリックすると、OpenStreetMapベースの地図が表示されます。

#### 地図上のマーカー

- **赤いマーカー**: デイサービス事業所（出発地点）
- **青いマーカー**: 一般利用者
- **紫のマーカー**: 車椅子対応が必要な利用者

各マーカーをクリックすると、利用者の詳細情報（氏名、住所、送迎時刻）がポップアップ表示されます。

### 4. ルート最適化機能

**「ルートを最適化」ボタン**をクリックすると、以下の処理が自動的に実行されます：

#### 最適化アルゴリズム

- **最近傍法（Nearest Neighbor）**を使用
- 事業所から出発し、現在地から最も近い未訪問の利用者を次の訪問先として選択
- すべての利用者を訪問するまで繰り返し

#### 表示される情報

**最適化された送迎ルート**セクションに以下が表示されます：

1. **総移動距離**: 全ルートの合計距離（km）
2. **予想所要時間**: 移動時間 + 各停車地での停車時間（3分/件）の合計
3. **訪問件数**: 訪問する利用者の総数
4. **訪問順序**: 事業所から順番に訪問する利用者のリスト

#### 地図上のルート表示

最適化されたルートは、地図上に**青い線**で表示されます。これにより、ドライバーは視覚的にどの順序で利用者を訪問すればよいかが一目で分かります。

### 5. 車両別割り当て

**車両別割り当て**セクションには、各車両に割り当てられた利用者が表示されます。

#### 割り当てロジック

- **車椅子対応が必要な利用者**を優先的に車椅子対応可能な車両に割り当て
- 各車両の定員と車椅子対応可能数を考慮
- 残りの一般利用者を順次割り当て

#### 表示内容

各車両カードには以下が表示されます：

- **車両名**と**担当ドライバー名**
- **一般利用者数** / 定員
- **車椅子利用者数** / 車椅子対応可能数
- **割り当てられた利用者のリスト**

## 使用手順

### 基本的な使い方

1. **アプリを開く**: ブラウザでアプリのURLにアクセス
2. **送迎対象者を確認**: 本日の送迎対象者一覧を確認
3. **地図を表示**: 「地図で表示」ボタンをクリックして、利用者の位置を確認
4. **ルートを最適化**: 「ルートを最適化」ボタンをクリック
5. **最適化結果を確認**: 
   - 総移動距離と予想所要時間を確認
   - 訪問順序を確認
   - 地図上の青い線でルートを視覚的に確認
6. **車両割り当てを確認**: 各車両に割り当てられた利用者を確認

### 実際の送迎時

1. 最適化された訪問順序に従って利用者を訪問
2. 地図上の青い線を参考にしながら移動
3. 各マーカーをクリックして、利用者の詳細情報を確認

## 技術仕様

### 使用技術

- **フロントエンド**: React 19.1.0
- **地図ライブラリ**: Leaflet.js + React Leaflet
- **地図データ**: OpenStreetMap
- **UIコンポーネント**: shadcn/ui + Tailwind CSS
- **アイコン**: Lucide React

### ルート最適化アルゴリズム

- **アルゴリズム**: 最近傍法（Nearest Neighbor）
- **距離計算**: ハーバーサイン公式による2点間の直線距離
- **所要時間計算**: 
  - 平均速度: 20 km/h
  - 各停車地での停車時間: 3分

### データ構造

現在はサンプルデータがアプリ内にハードコードされていますが、将来的にはGoogleスプレッドシートと連携して、リアルタイムでデータを読み込むことが可能です。

## 今後の拡張予定

### Phase 3: Googleスプレッドシート連携

- Google Sheets APIを使用して、利用者・車両・予定データを外部から読み込み
- データの更新をリアルタイムで反映

### Phase 4: 高度なルート最適化

- Google Maps Directions APIまたはOSRM（Open Source Routing Machine）を使用
- 実際の道路網を考慮したルート計算
- 交通状況を考慮した所要時間予測

### Phase 5: 通知機能

- LINE通知またはメール通知
- 送迎開始時刻の通知
- 到着予定時刻の通知

### Phase 6: モバイル対応

- スマートフォン・タブレットでの使いやすさを向上
- オフライン機能

## トラブルシューティング

### 地図が表示されない

- インターネット接続を確認してください
- ブラウザのキャッシュをクリアしてページを再読み込みしてください

### マーカーが表示されない

- 利用者データに座標（lat, lng）が含まれているか確認してください
- ブラウザのコンソールでエラーメッセージを確認してください

### ルート最適化が動作しない

- 利用者データと事業所データが正しく読み込まれているか確認してください
- ブラウザのコンソールでエラーメッセージを確認してください

## サポート

ご質問やバグ報告は、GitHubリポジトリのIssuesセクションにお願いします。

**GitHubリポジトリ**: https://github.com/SHUJIRO1234/dayservice-transport-app

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

