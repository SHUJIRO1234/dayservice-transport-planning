# 地理的クラスタリング機能テスト結果

## テスト日時
2025年10月24日

## テスト概要
デイサービス送迎計画アプリケーションに実装した地理的クラスタリング機能の動作確認を実施しました。

## テストシナリオ
1. 月曜日の30名の利用者を5台の送迎車に自動割り当て
2. 地理的クラスタリングによる効率的なグループ化
3. ルート最適化による最短経路の計算
4. 地図表示による視覚的な確認

## テスト結果

### 自動割り当て結果
地理的クラスタリングを使用した自動割り当てが成功しました。

| 車両 | 担当者 | 割り当て人数 | 車椅子利用者 | 定員 | 車椅子定員 |
|------|--------|-------------|-------------|------|-----------|
| 送迎車1号 | 佐藤 花子 | 9名 | 1名 | 8名 | 2台 |
| 送迎車2号 | 中村 次郎 | 6名 | 1名 | 6名 | 1台 |
| 送迎車3号 | 田中 三郎 | 4名 | 2名 | 8名 | 2台 |
| 送迎車4号 | 山田 美咲 | 6名 | 1名 | 7名 | 1台 |
| 送迎車5号 | 鈴木 健太 | 5名 | 3名 | 6名 | 1台 |
| **合計** | - | **30名** | **8名** | **35名** | **7台** |

**未割り当て**: 0名（全員が割り当てられました）

### 地理的クラスタリングの効果

#### 送迎車1号の割り当て（第1便）
- **利用者数**: 8名
- **距離**: 8.12 km
- **時間**: 49分
- **エリア**: 台東区根岸、台東区下谷、台東区台東、北区田端

**利用者リスト**:
1. 清水 勝（車椅子）- 北区田端3-14-6
2. 阿部 博 - 台東区根岸2-19-5
3. 山口 大輔 - 台東区下谷2-10-15
4. 青木 実 - 台東区台東2-19-5
5. 中野 恵子 - 台東区根岸5-8-9
6. 竹内 美咲 - 台東区下谷2-10-15
7. 石井 実 - 台東区下谷2-10-15
8. 後藤 武 - 台東区根岸2-19-5

**観察**:
- 台東区と北区田端エリアの利用者が同じ車両にまとまっている
- 地理的に近い利用者がグループ化されている
- 車椅子対応の制約が正しく適用されている

### 地図表示による視覚的確認
地図上で各車両の担当エリアを確認した結果:
- 各車両（色分けされた番号マーカー）が地理的に近い利用者をグループ化
- 青色（送迎車1号）のマーカーが台東区・北区田端エリアに集中
- 緑色（送迎車2号）のマーカーが別のエリアに集中
- 赤色、紫色、ピンク色の各車両も、それぞれ地理的にまとまったエリアを担当

### ルート最適化の効果
全ルート最適化を実行した結果:
- 各車両のルートが2-optアルゴリズムによって最適化された
- 地図上のマーカーの番号が変更され、最短経路が計算された
- 送迎車1号の第1便で距離8.12km、時間49分という効率的なルートが生成された

## 機能の評価

### 成功した点
1. **地理的クラスタリングの実装**: K-meansアルゴリズムを使用して、地理的に近い利用者を同じ車両にグループ化することに成功
2. **車椅子対応の制約**: 車椅子利用者の制約が正しく適用され、各車両の車椅子定員を超えないように割り当てられた
3. **定員管理**: 各車両の定員を超えないように自動的に複数便に分割された
4. **ルート最適化**: 2-optアルゴリズムによる最短経路の計算が正常に動作
5. **地図表示**: OpenStreetMap/Leafletによる視覚的な確認が可能

### 改善の余地
1. **定員超過の処理**: 送迎車1号が9名割り当てられているが、定員は8名（要確認）
2. **複数便の自動生成**: 定員を超える場合の複数便への自動分割ロジックの改善
3. **クラスタリングの精度**: より高度なクラスタリングアルゴリズムの検討（DBSCAN、階層的クラスタリングなど）

## 結論
地理的クラスタリング機能は正常に動作し、効率的な送迎計画の作成に成功しました。地理的に近い利用者を同じ車両にグループ化することで、移動距離を最小化し、効率的なルートを実現できました。

ルート最適化と組み合わせることで、さらに効率的な送迎計画が可能になりました。

## 次のステップ
1. 定員超過の問題を調査・修正
2. 複数便への自動分割ロジックの改善
3. 他の曜日でのテスト実施
4. ユーザーフィードバックの収集

