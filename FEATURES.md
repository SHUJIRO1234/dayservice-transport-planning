# デイサービス送迎計画アプリ - 実装済み機能一覧

## 📅 曜日別管理機能

デイサービスの営業日である月曜日から金曜日まで、各曜日ごとに利用者と送迎計画を管理できます。画面上部の曜日タブをクリックすることで、簡単に曜日を切り替えることができます。各曜日には最大30名の利用者を登録でき、利用者は複数の曜日に登録することも可能です。例えば、週1回利用の方は月曜日のみ、週2回利用の方は月曜日と木曜日、週5回利用の方は月曜日から金曜日まで登録されています。

土曜日と日曜日は休業日として設定されており、利用者数は0名となっています。この設定により、実際のデイサービスの運営形態に合わせた管理が可能です。

## 🚐 送迎車別管理機能

5台の送迎車（1号〜5号）を個別に管理できます。各送迎車には担当ドライバー、定員、車椅子対応可能数が設定されており、送迎車タブをクリックすることで、各車両の詳細情報と割り当てられた利用者を確認できます。

**送迎車の仕様:**
- **送迎車1号**: 担当 佐藤 花子、定員 8名、車椅子 2台
- **送迎車2号**: 担当 中村 次郎、定員 6名、車椅子 1台
- **送迎車3号**: 担当 田中 三郎、定員 8名、車椅子 2台
- **送迎車4号**: 担当 山田 美咲、定員 7名、車椅子 1台
- **送迎車5号**: 担当 鈴木 健太、定員 6名、車椅子 1台

各送迎車のタブには、現在の利用者数と車椅子対応数が表示され、定員を超えないように視覚的に確認できます。

## 🤖 自動割り当て機能

未割り当ての利用者を、車椅子対応の必要性を考慮しながら、各送迎車に自動的に割り当てます。この機能により、手動で一人ずつ割り当てる手間を大幅に削減できます。

**自動割り当てのアルゴリズム:**
1. 車椅子対応が必要な利用者を優先的に処理
2. 車椅子対応可能な車両に順次割り当て
3. 各車両の車椅子定員を超えないように制御
4. 一般利用者を残りの定員に割り当て

自動割り当て後も、手動で利用者を移動させることができるため、柔軟な調整が可能です。

## 🗺️ ルート最適化機能

各送迎車に割り当てられた利用者の訪問順序を、最近傍法（Nearest Neighbor Algorithm）を用いて自動的に最適化します。この機能により、移動距離を最小化し、効率的な送迎ルートを計算できます。

**ルート最適化の特徴:**
- デイサービスから出発
- 最も近い利用者から順に訪問
- すべての利用者をピックアップ
- デイサービスに戻る

最適化されたルートには、総移動距離（km）と予想所要時間（分）が表示されます。例えば、送迎車1号の第1便では、8名の利用者を訪問するルートが9.78 km、54分と計算されます。

## ⏱️ 距離・時間の自動計算

ルート最適化を実行すると、各送迎車の総移動距離と予想所要時間が自動的に計算され、画面に表示されます。この計算には、利用者の住所から座標を取得し、座標間の直線距離を計算する方法を採用しています。

**計算方法:**
- 座標間の距離: ハーバーサイン公式（Haversine Formula）
- 予想所要時間: 平均速度 20 km/h で計算
- 各利用者宅での停車時間: 5分を加算

手動で訪問順序を変更した場合も、距離と時間が自動的に再計算されるため、常に最新の情報を確認できます。

## 🔄 手動ルート編集機能

自動最適化されたルートを、ドラッグ&ドロップで手動調整できます。各利用者カードの左側にあるドラッグハンドル（縦線のアイコン）をドラッグすることで、訪問順序を自由に入れ替えることができます。

**使い方:**
1. 送迎車タブを選択
2. 利用者カードをドラッグ
3. 希望の位置にドロップ
4. 距離と時間が自動的に再計算される

この機能により、道路事情や利用者の希望時刻など、アルゴリズムでは考慮できない要素を反映させることができます。

## 🚌 複数便（往復）機能

車両台数が不足する場合やドライバーの欠勤時に、1台の送迎車で複数回に分けて送迎できる機能です。各送迎車の画面下部にある「便を追加」ボタンをクリックすることで、第2便、第3便を追加できます。

**複数便の特徴:**
- 便ごとに利用者を割り当て
- 便ごとに距離・時間を表示
- 便ごとにルート最適化が可能
- 不要な便は削除可能

例えば、送迎車1号で第1便（8:00-8:54）に8名、第2便（9:00-9:45）に5名を送迎するといった運用が可能です。

## 👥 利用者情報の詳細表示

各利用者カードには、以下の情報が表示されます：

- **氏名**: 利用者の名前
- **住所**: 自宅の住所
- **送迎時刻**: 希望する送迎時刻
- **車椅子対応**: 車椅子マーク（🦽）で表示
- **備考**: 認知症あり、玄関まで介助必要、2階まで介助必要など

これらの情報により、ドライバーは各利用者の状況を一目で把握できます。

## 📊 サマリー情報

画面上部には、選択中の曜日の送迎状況をサマリーで表示します：

- **送迎対象者数**: 本日の総利用者数
- **車椅子対応**: 車椅子対応が必要な利用者数と一般利用者数
- **利用可能車両**: 送迎車の台数
- **未割り当て**: まだ送迎車に割り当てられていない利用者数

このサマリーにより、全体の状況を素早く把握できます。

## 🗺️ 地図表示機能（基本版）

「地図で表示」ボタンをクリックすると、OpenStreetMapベースの地図上に、デイサービスと利用者の位置がマーカーで表示されます。最適化されたルートは青い線で描かれ、視覚的にルートを確認できます。

**地図の特徴:**
- デイサービス: 赤いマーカー
- 一般利用者: 青いマーカー
- 車椅子対応利用者: 紫のマーカー
- 最適化ルート: 青い線
- ズーム・ドラッグ操作が可能

## 📱 レスポンシブデザイン

アプリはレスポンシブデザインを採用しており、パソコン、タブレット、スマートフォンなど、さまざまなデバイスで利用できます。画面サイズに応じて、レイアウトが自動的に調整されます。

## 🎨 美しいUI/UX

shadcn/uiとTailwind CSSを使用した、モダンで美しいユーザーインターフェースを実装しています。グラデーション背景、ホバー効果、スムーズなアニメーションなど、使いやすさと見た目の美しさを両立しています。

---

## 今後の拡張予定

### 送迎車間でのドラッグ&ドロップ移動
利用者を送迎車1号から送迎車2号へ、ドラッグ&ドロップで移動できる機能を追加予定です。

### 送迎車別の地図表示
各送迎車のルートを異なる色で地図上に表示し、送迎車タブに応じて表示を切り替える機能を追加予定です。

### Googleスプレッドシート連携
Googleスプレッドシートから利用者データを読み込み、リアルタイムでデータを同期する機能を追加予定です。

### LINE通知機能
送迎開始時刻や到着予定時刻を、利用者やご家族にLINEで通知する機能を追加予定です。

### 実際の道路網を考慮したルート計算
Google Maps APIなどを使用して、実際の道路網と交通状況を考慮した、より正確なルート計算機能を追加予定です。

