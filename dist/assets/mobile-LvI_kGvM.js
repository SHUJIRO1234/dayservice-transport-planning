import{a as i,j as e,B as p,h as D,N as C,C as M,w as A,v as E,i as U,l as L,R as B}from"./weeklyData-Cs_Bueq0.js";const F=({vehicle:r,selectedDay:N,facility:d})=>{const[v,g]=i.useState(null),u=r.trips.reduce((s,t)=>s+t.users.filter(l=>l.wheelchair).length,0),b=(s,t)=>{navigator.clipboard.writeText(s),g(t),setTimeout(()=>g(null),2e3)},x=s=>{const t=encodeURIComponent(s);window.open(`https://www.google.com/maps/search/?api=1&query=${t}`,"_blank")},w=()=>{const s=r.trips.flatMap(t=>t.users.map((l,a)=>`${a+1}. ${l.name} - ${l.address}`)).join(`
`);navigator.clipboard.writeText(`${d.name}
↓
${s}
↓
${d.name}`),alert("全ての住所をコピーしました")};return e.jsxs("div",{className:"mobile-driver-view bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 sticky top-0 z-10 shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.name}),e.jsxs("div",{className:"text-sm opacity-90",children:[e.jsxs("div",{children:["担当: ",r.driver]}),e.jsx("div",{children:N})]})]}),e.jsxs("div",{className:"bg-white p-4 m-4 rounded-lg shadow",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.trips.reduce((s,t)=>s+t.users.length,0)}),e.jsx("div",{className:"text-xs text-gray-600",children:"利用者数"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[u,"/",r.wheelchairCapacity]}),e.jsx("div",{className:"text-xs text-gray-600",children:"車椅子"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.trips.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"便数"})]})]}),e.jsxs(p,{onClick:w,className:"w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-6 text-lg",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"全住所をコピー（カーナビ用）"]})]}),r.trips.map((s,t)=>{var l;return e.jsxs("div",{className:"m-4",children:[e.jsx("div",{className:"bg-gray-800 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xl font-bold",children:["第",t+1,"便"]}),e.jsxs("div",{className:"text-sm",children:[s.users.length,"名 | ",((l=s.distance)==null?void 0:l.toFixed(1))||"0.0"," km | ",s.duration||0,"分"]})]})}),e.jsx("div",{className:"space-y-3 bg-white p-4 rounded-b-lg shadow",children:s.users.map((a,n)=>e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold",children:n+1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:a.name}),a.wheelchair&&e.jsx("span",{className:"inline-block bg-red-500 text-white text-xs px-2 py-1 rounded mt-1",children:"車椅子"})]})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.pickupTime})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded mb-3",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"住所"}),e.jsx("div",{className:"text-lg font-medium",children:a.address})]}),a.specialNeeds&&e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3",children:[e.jsx("div",{className:"text-sm font-bold text-yellow-800 mb-1",children:"⚠️ 特記事項"}),e.jsx("div",{className:"text-sm text-yellow-900",children:a.specialNeeds})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(p,{onClick:()=>x(a.address),className:"bg-blue-600 hover:bg-blue-700 text-white py-6 text-base",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"ナビで開く"]}),e.jsx(p,{onClick:()=>b(a.address,`${t}-${n}`),variant:"outline",className:"py-6 text-base",children:v===`${t}-${n}`?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-5 h-5 mr-2 text-green-600"}),"コピー済み"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"住所コピー"]})})]})]},a.id))})]},t)}),e.jsxs("div",{className:"bg-white p-6 m-4 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-lg font-bold mb-2",children:"施設に戻る"}),e.jsx("div",{className:"text-gray-600 mb-3",children:d.name}),e.jsx("div",{className:"text-sm text-gray-500",children:d.address}),e.jsxs(p,{onClick:()=>x(d.address),className:"w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-6 text-lg",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"施設へのルートを開く"]})]})]})},V=()=>{const[r,N]=i.useState(null),[d,v]=i.useState("月曜日"),[g,u]=i.useState("Trip 1"),[b,x]=i.useState(null),[w,s]=i.useState(!0),[t,l]=i.useState(null),[a,n]=i.useState("");return i.useEffect(()=>{var y;try{const o=new URLSearchParams(window.location.search),m=o.get("vehicle"),j=o.get("day")||"月曜日",f=`Trip ${o.get("trip")||"1"}`;if(!m){l("車両IDが指定されていません"),s(!1);return}N(parseInt(m)),v(j),u(f);const I=`transport-${j}-${f}`,S=localStorage.getItem(I);if(S)try{const h=(y=JSON.parse(S).vehicles)==null?void 0:y.find(T=>T.id===parseInt(m));if(h&&h.trips&&h.trips.length>0){x(h),n("localStorage"),s(!1);return}}catch(c){console.warn("ローカルストレージのデータ解析に失敗:",c)}const $=A[j]||[];if($.length===0){l(`${j}には利用者データがありません`),s(!1);return}const k=E.find(c=>c.id===parseInt(m));if(!k){l(`車両ID ${m} が見つかりません`),s(!1);return}const R={...k,trips:[{users:$.map((c,h)=>({...c,specialNeeds:c.note||(c.wheelchair?"車椅子対応が必要です":"")})),distance:0,duration:0}]};x(R),n("weeklyData"),s(!1)}catch(o){console.error("データ読み込みエラー:",o),l("データの読み込みに失敗しました"),s(!1)}},[]),w?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold mb-2",children:"読み込み中..."}),e.jsx("div",{className:"text-sm text-gray-500",children:"運行データを取得しています"})]})}):t?e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md bg-white p-8 rounded-lg shadow-lg",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold mb-4 text-red-600",children:"エラー"}),e.jsx("p",{className:"text-gray-700 mb-4",children:t}),e.jsxs("p",{className:"text-sm text-gray-500 mb-6",children:["URLパラメータを確認してください。",e.jsx("br",{}),"例: ?vehicle=1&day=月曜日&trip=1"]}),e.jsx("a",{href:"/",className:"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"メインアプリへ戻る"})]})}):b?e.jsxs("div",{children:[a==="weeklyData"&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 p-2 text-center text-xs text-yellow-800",children:"ℹ️ 基本データを表示中（メインアプリで自動割り当てを実行すると、最適化されたルートが表示されます）"}),e.jsx(F,{vehicle:b,selectedDay:d,selectedTrip:g,facility:U})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🚗"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"車両が見つかりません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"URLを確認してください"}),e.jsx("a",{href:"/",className:"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"メインアプリへ戻る"})]})})};L.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(V,{})}));
