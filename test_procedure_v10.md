# テスト手順書 v10 - 自動割り当てとドロップゾーンの修正確認

## テスト環境
- アプリケーションURL: https://8080-i6ce68ubdkv1vx1kk87lx-14f4b140.manusvm.computer
- ブランチ: branch-6
- コミット: 7f20208

## 修正内容

### 修正1: 自動割り当て時に既存の利用者が消える問題
- **変更前**: 自動割り当てを実行すると、既存の割り当てが完全にリセットされる
- **変更後**: 既存の割り当てを保持したまま、未割り当てリストの利用者だけを追加で割り当てる

### 修正2: ドロップゾーンの範囲拡大
- **変更前**: ドロップゾーンの範囲が狭く、ドロップに失敗すると利用者が消える
- **変更後**: 
  - ドロップゾーンの範囲を拡大（min-height: 100px → 150px（タブビュー）、60px → 80px（全体ビュー））
  - ドロップ時に「ここにドロップできます」というメッセージを表示
  - ドロップ失敗時にアラートを表示し、利用者が消えないようにする

## テスト1: 自動割り当ての追加モード

### 前提条件
- アプリケーションを開く
- 月曜日を選択
- ローカルストレージをクリア（ブラウザの開発者ツール > Application > Local Storage > Clear）
- ページをリロード

### テスト手順
1. **初回の自動割り当て**
   - 「自動割り当て」ボタンをクリック
   - **期待される結果**: 全ての利用者が車両に割り当てられる

2. **一部の利用者を未割り当てに戻す**
   - 送迎車1号の第1便から2名の利用者を未割り当てリストにドラッグ&ドロップ
   - **期待される結果**: 2名が未割り当てリストに戻る

3. **再度自動割り当てを実行**
   - 「自動割り当て」ボタンをクリック
   - **期待される結果**: 
     - 戻した2名が車両に割り当てられる
     - **それ以前に割り当てられていた利用者は消えない**（重要）
     - 既存の割り当てが保持される

4. **確認**
   - 各車両の利用者数を確認
   - 未割り当てリストが空になっていることを確認
   - **全ての利用者が存在することを確認**（誰も消えていない）

### 合格基準
- ✅ 再度自動割り当てを実行しても、既存の利用者が消えない
- ✅ 未割り当てリストの利用者だけが追加で割り当てられる
- ✅ 全ての利用者が存在する（誰も消えていない）

## テスト2: ドロップゾーンの範囲拡大（タブビュー）

### 前提条件
- アプリケーションを開く
- 「タブビュー」を選択
- 自動割り当てを実行して利用者を割り当てる

### テスト手順
1. **ドロップゾーンの視覚的確認**
   - 未割り当てリストから利用者をドラッグ
   - **期待される結果**: 
     - 便のカード全体が緑色（青色）に変わる
     - 「ここにドロップできます」というメッセージが表示される
     - ドロップゾーンの範囲が広い（min-height: 150px）

2. **ドロップの成功**
   - 便のカードの中央にドロップ
   - **期待される結果**: 利用者が便に追加される

3. **ドロップの失敗**
   - 未割り当てリストから利用者をドラッグ
   - 便のカードの外側（白い部分）にドロップ
   - **期待される結果**: 
     - アラートが表示される「ドロップ失敗: 青いドロップゾーンにドロップしてください。利用者は元の位置に残りました。」
     - 利用者が未割り当てリストに残る（消えない）

4. **空の便へのドロップ**
   - 「便を追加」ボタンをクリックして空の便を作成
   - 未割り当てリストから利用者をドラッグ
   - 空の便にドロップ
   - **期待される結果**: 
     - 空の便でもドロップゾーンが十分な高さを持つ（150px）
     - 利用者が便に追加される

### 合格基準
- ✅ ドロップゾーンの範囲が広く、ドロップしやすい
- ✅ ドロップ時に視覚的なフィードバックがある
- ✅ ドロップ失敗時にアラートが表示される
- ✅ ドロップ失敗時に利用者が消えない

## テスト3: ドロップゾーンの範囲拡大（全体ビュー）

### 前提条件
- アプリケーションを開く
- 「全体ビュー」を選択
- 自動割り当てを実行して利用者を割り当てる

### テスト手順
1. **ドロップゾーンの視覚的確認**
   - 未割り当てリストから利用者をドラッグ
   - **期待される結果**: 
     - 便のカード全体が青色に変わる
     - 「ドロップOK」というメッセージが表示される
     - ドロップゾーンの範囲が広い（min-height: 80px）

2. **複数の車両へのドロップ**
   - 未割り当てリストから利用者をドラッグ
   - 送迎車1号の第1便にドロップ
   - 別の利用者を送迎車2号の第1便にドロップ
   - **期待される結果**: 各車両に利用者が追加される

3. **ドロップの失敗**
   - 未割り当てリストから利用者をドラッグ
   - 車両パネルの外側にドロップ
   - **期待される結果**: 
     - アラートが表示される
     - 利用者が未割り当てリストに残る（消えない）

### 合格基準
- ✅ 全体ビューでもドロップゾーンの範囲が広い
- ✅ ドロップ時に視覚的なフィードバックがある
- ✅ ドロップ失敗時に利用者が消えない

## テスト4: 車両間のドラッグ&ドロップ

### 前提条件
- アプリケーションを開く
- 自動割り当てを実行して利用者を割り当てる

### テスト手順
1. **車両間の移動**
   - 送迎車1号の第1便から利用者をドラッグ
   - 送迎車2号の第1便にドロップ
   - **期待される結果**: 利用者が送迎車2号に移動する

2. **便間の移動**
   - 送迎車1号の第1便から利用者をドラッグ
   - 送迎車1号の第2便にドロップ
   - **期待される結果**: 利用者が第2便に移動する

3. **未割り当てへの移動**
   - 送迎車1号の第1便から利用者をドラッグ
   - 未割り当てリストにドロップ
   - **期待される結果**: 利用者が未割り当てリストに戻る

### 合格基準
- ✅ 車両間の移動が正常に動作する
- ✅ 便間の移動が正常に動作する
- ✅ 未割り当てへの移動が正常に動作する
- ✅ どの操作でも利用者が消えない

## テスト5: 定員チェック

### 前提条件
- アプリケーションを開く
- 自動割り当てを実行して利用者を割り当てる

### テスト手順
1. **定員オーバーのチェック**
   - 送迎車1号の第1便が定員に達するまで利用者を追加
   - さらに利用者を追加しようとする
   - **期待される結果**: 
     - アラートが表示される「定員オーバーです。送迎車1号の定員は9名です。」
     - 利用者が元の場所に残る

2. **車椅子定員オーバーのチェック**
   - 送迎車1号の第1便に車椅子利用者を2台追加
   - さらに車椅子利用者を追加しようとする
   - **期待される結果**: 
     - アラートが表示される「車椅子定員オーバーです。送迎車1号の車椅子定員は2台です。」
     - 利用者が元の場所に残る

### 合格基準
- ✅ 定員チェックが正常に動作する
- ✅ 車椅子定員チェックが正常に動作する
- ✅ 定員オーバー時にアラートが表示される
- ✅ 定員オーバー時に利用者が元の場所に残る

## テスト6: 曜日ごとのデータ分離

### 前提条件
- アプリケーションを開く
- ローカルストレージをクリア
- ページをリロード

### テスト手順
1. **月曜日の割り当て**
   - 月曜日を選択
   - 自動割り当てを実行
   - 一部の利用者を手動で調整

2. **火曜日の割り当て**
   - 火曜日を選択
   - **期待される結果**: 未割り当てリストが初期状態に戻る（月曜日の割り当てが反映されない）
   - 自動割り当てを実行

3. **月曜日の確認**
   - 月曜日を選択
   - **期待される結果**: 月曜日の割り当て状態が保持されている

### 合格基準
- ✅ 曜日ごとにデータが分離されている
- ✅ 各曜日で個別に調整できる
- ✅ 曜日を切り替えても、それぞれの割り当て状態が保持される

## 不具合が発生した場合

### 不具合報告フォーマット
```
不具合タイトル: [簡潔な説明]

再現手順:
1. [手順1]
2. [手順2]
3. [手順3]

期待される結果:
[期待される動作]

実際の結果:
[実際に発生した動作]

スクリーンショット:
[可能であれば添付]

ブラウザコンソールのエラー:
[F12 > Console タブのエラーメッセージ]
```

## テスト完了チェックリスト

- [ ] テスト1: 自動割り当ての追加モード
- [ ] テスト2: ドロップゾーンの範囲拡大（タブビュー）
- [ ] テスト3: ドロップゾーンの範囲拡大（全体ビュー）
- [ ] テスト4: 車両間のドラッグ&ドロップ
- [ ] テスト5: 定員チェック
- [ ] テスト6: 曜日ごとのデータ分離

## 次のステップ

テストが完了したら、以下の情報をお知らせください:
1. 全てのテストが合格したか
2. 不具合が見つかった場合は、上記のフォーマットで報告
3. 追加で必要な機能や改善点

修正が必要な場合は、追加で対応します。

