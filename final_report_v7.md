# デイサービス送迎計画アプリ：順番固定機能の実装レポート

> サービス内容などにより、迎えの時間（順番）もある程度柔軟に向かえができる利用者もいれば、その時間（順番）が必ず決まっている利用者もいます。その辺りも対応するにはどんな実装を加える必要あるかな？

ご要望いただいた「順番固定機能」を実装しましたので、ご報告いたします。

## 実装した機能

### 1. 順番固定チェックボックス

各利用者カードの右側に「固定」というチェックボックスを追加しました。（タブビューで表示されます）

- **チェックを入れる**: その利用者の順番が固定されます。
- **チェックを外す**: 最適化の対象になります。

### 2. 固定状態の視覚的な表示

順番を固定すると、以下の表示が追加されます：

- **ピンアイコン**: 全体ビューで名前の横に表示
- **「順番固定」バッジ**: タブビューで名前の横に表示

これにより、誰の順番が固定されているか一目でわかります。

### 3. 固定に対応した最適化ロジック

「最適化」ボタンを押した際の動作を改善しました。

- **固定された利用者**: 現在の位置を維持し、動かさない
- **柔軟な利用者**: 固定されていない利用者のみで最短ルートを計算

これにより、「この人は必ず最初」「この人は必ず最後」といった、現場の細かな要望に対応できます。

## 確認方法

プレビューURLで最新版をご確認ください：
**https://8080-i6ce68ubdkv1vx1kk87lx-14f4b140.manusvm.computer**

1. **タブビュー**に切り替え
2. 1号車の2番目の利用者の「固定」にチェックを入れる
3. 「最適化」ボタンを押す
4. 2番目の利用者の位置が変わらず、他の利用者の順番が変わることを確認

## 今後の展望

今回は「固定順番」のみを実装しましたが、将来的には以下のような、より高度な時間制約にも対応できます：

- **時間指定**: 「9:00〜9:30の間」といった指定
- **優先度**: 「必ず最初」「必ず最後」といった指定

まずは今回の機能をお試しいただき、フィードバックをいただけますと幸いです。

