# ドラッグ&ドロップ機能の改善とリセット機能の追加

## 実装日
2025年10月15日

## 改善内容

### 1. 車両から未割り当てに戻す機能 ✅
- 割り当てた利用者を未割り当てリストにドラッグ&ドロップで戻せるようになりました
- 誤って割り当てた利用者を簡単に戻すことができます

### 2. リセット機能の追加 ✅
#### 全リセットボタン
- すべての車両の割り当てをクリアし、全利用者を未割り当てに戻します
- 最初からやり直したい時に便利です

#### 車両ごとのリセットボタン
- 選択中の車両のみの割り当てをクリアします
- 特定の車両だけやり直したい時に使用します

### 3. 送迎車間での利用者移動 ✅
- 送迎車1号から送迎車2号へ、利用者をドラッグ&ドロップで移動できます
- 車両間での調整が簡単になりました

### 4. 便内での順序入れ替え ✅
- 同じ便の中で、利用者の訪問順序をドラッグ&ドロップで入れ替え可能
- 順序を変更すると、距離と時間が自動的に再計算されます
- 手動で最適な順序を調整できます

### 5. ドロップゾーンの改善 ✅
- タブではなく、便のエリア全体がドロップゾーンになりました
- ドロップ時に緑色にハイライトされ、どこにドロップできるか分かりやすくなりました
- ドラッグ&ドロップの操作性が大幅に向上しました

### 6. ルート最適化ボタンの修正 ✅
- 車両ごとの「ルート最適化」ボタンが正しく動作するようになりました
- クリックすると、その車両の第1便のルートを最適化します

## 使い方

### 未割り当てから車両へ
1. 左側の未割り当てリストから利用者カードをドラッグ
2. 右側の便のエリア（グレーの背景）にドロップ
3. 緑色にハイライトされたらドロップ

### 車両から未割り当てへ
1. 右側の便内の利用者カードをドラッグ
2. 左側の未割り当てリストエリアにドロップ

### 車両間での移動
1. 送迎車1号の便内の利用者カードをドラッグ
2. 送迎車2号のタブをクリックして切り替え
3. 送迎車2号の便のエリアにドロップ

### 便内での順序入れ替え
1. 便内の利用者カードをドラッグ
2. 同じ便内の別の利用者カードの上にドロップ
3. 距離と時間が自動的に再計算されます

### リセット
- **全リセット**: 画面上部の「全リセット」ボタンをクリック
- **車両ごとのリセット**: 車両の詳細画面の「リセット」ボタンをクリック

## 技術的な詳細

### 使用ライブラリ
- @dnd-kit/core: ドラッグ&ドロップ機能の実装
- @dnd-kit/sortable: ソート可能なリストの実装

### 主な変更ファイル
- `src/App.jsx`: ドラッグ&ドロップロジックの全面改善
- `src/components/TripManager.jsx`: ドロップゾーンの実装
- `src/components/VehicleTabs.jsx`: タブコンポーネントの最適化

### ドラッグ&ドロップの仕組み
1. **ドラッグ開始**: `handleDragStart`でドラッグ中の利用者IDを記録
2. **ドロップ先判定**: `handleDragEnd`でドロップ先を特定
3. **データ更新**: 元の場所から削除し、新しい場所に追加
4. **距離・時間再計算**: ドロップ後に自動的に再計算

## 今後の拡張予定
- 複数の利用者を一度に移動する機能
- ドラッグ中のプレビュー表示の改善
- アンドゥ/リドゥ機能

