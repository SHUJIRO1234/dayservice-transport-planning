# 印刷・出力機能の設計ドキュメント

## 概要

デイサービス送迎計画アプリケーションに、実務で使用できる印刷・出力機能を実装します。ドライバーや事務スタッフが紙やPDFで送迎計画を確認・共有できるようにします。

## 実装する機能

### Phase 1: 基本的な印刷機能

#### 1. 送迎計画表（一覧形式）
**目的**: 全体の送迎計画を一覧で確認できる資料

**内容**:
- 日付と曜日
- 車両ごとの利用者リスト
- 各便の利用者数、距離、時間
- 担当ドライバー名
- 車椅子対応の有無

**レイアウト**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  デイサービス送迎計画表
  日付: 2025年10月26日（月曜日）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【送迎車1号】担当: 佐藤 花子
定員: 8/8名  車椅子: 1/2台

第1便（8名 / 8.12 km / 49分）
  1. 清水 勝 [車椅子] - 北区田端3-14-6
  2. 阿部 博 - 台東区根岸2-19-5
  3. 後藤 武 - 台東区根岸2-19-5
  ...

第2便（1名 / 3.32 km / 13分）
  1. 藤田 明子 - 台東区根岸3-9-12

─────────────────────────────────────

【送迎車2号】担当: 中村 次郎
...
```

#### 2. ドライバー用運行指示書（詳細形式）
**目的**: ドライバーが実際の運行で使用する詳細な指示書

**内容**:
- 車両名と担当ドライバー名
- 便ごとの詳細な運行指示
- 各利用者の情報:
  - 氏名
  - 住所（郵便番号含む）
  - 送迎時間
  - 車椅子の有無
  - 特記事項（認知症など）
- 施設の出発・到着時刻
- 総距離と所要時間

**レイアウト**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  運行指示書 - 送迎車1号
  担当: 佐藤 花子
  日付: 2025年10月26日（月曜日）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【第1便】
出発時刻: 08:00
総距離: 8.12 km / 所要時間: 49分

┌─────────────────────────────────────┐
│ 1. 清水 勝 様 [車椅子対応]                    │
│ 住所: 〒114-0014 北区田端3-14-6               │
│ 送迎時間: 08:00                               │
│ 特記事項: 認知症あり                          │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 2. 阿部 博 様                                 │
│ 住所: 〒110-0003 台東区根岸2-19-5             │
│ 送迎時間: 08:00                               │
│ 特記事項: なし                                │
└─────────────────────────────────────┘

...

施設到着予定: 08:49
```

#### 3. 地図付きルート表
**目的**: 送迎ルートを視覚的に確認できる資料

**内容**:
- 車両ごとの送迎ルート地図
- 番号付きマーカーで順序を表示
- 利用者リストと地図の対応
- 距離と時間の情報

**レイアウト**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  送迎ルート地図 - 送迎車1号 第1便
  日付: 2025年10月26日（月曜日）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[地図画像]

送迎順序:
  1. 清水 勝 [車椅子] - 北区田端3-14-6
  2. 阿部 博 - 台東区根岸2-19-5
  3. 後藤 武 - 台東区根岸2-19-5
  ...

総距離: 8.12 km
所要時間: 49分
```

## 技術的な実装方法

### 1. 印刷用CSSの作成

**ファイル**: `src/styles/print.css`

```css
@media print {
  /* 印刷時に不要な要素を非表示 */
  .no-print {
    display: none !important;
  }
  
  /* ページ設定 */
  @page {
    size: A4;
    margin: 20mm;
  }
  
  /* 改ページ制御 */
  .page-break {
    page-break-after: always;
  }
  
  .avoid-break {
    page-break-inside: avoid;
  }
}
```

### 2. 印刷用コンポーネントの作成

**コンポーネント構造**:
```
src/components/print/
├── PrintLayout.jsx          # 印刷レイアウトの基本構造
├── TransportPlanPrint.jsx   # 送迎計画表
├── DriverInstructionPrint.jsx # 運行指示書
└── RouteMapPrint.jsx        # 地図付きルート表
```

### 3. 印刷ボタンの追加

**配置場所**:
- 全体ビューの上部に「印刷」ボタンを追加
- クリックすると印刷オプションのモーダルを表示
- 印刷する内容を選択（計画表、指示書、地図）

**モーダルの内容**:
```
┌─────────────────────────────────┐
│  印刷オプション                  │
├─────────────────────────────────┤
│  □ 送迎計画表（一覧形式）        │
│  □ 運行指示書（詳細形式）        │
│  □ 地図付きルート表              │
│                                  │
│  対象車両:                       │
│  ☑ 全車両                        │
│  □ 送迎車1号                     │
│  □ 送迎車2号                     │
│  ...                             │
│                                  │
│  [キャンセル]  [印刷プレビュー]  │
└─────────────────────────────────┘
```

### 4. 印刷プレビュー機能

- 印刷プレビューボタンをクリックすると、新しいウィンドウで印刷用ページを表示
- ブラウザの印刷機能（Ctrl+P）で印刷またはPDF保存
- 印刷用ページには、選択された内容のみを表示

## 実装の流れ

### Step 1: 印刷用CSSの作成
1. `src/styles/print.css` を作成
2. 印刷時のレイアウトとスタイルを定義
3. `App.jsx` でインポート

### Step 2: 印刷用コンポーネントの作成
1. `PrintLayout.jsx` を作成（共通レイアウト）
2. `TransportPlanPrint.jsx` を作成（送迎計画表）
3. `DriverInstructionPrint.jsx` を作成（運行指示書）
4. `RouteMapPrint.jsx` を作成（地図付きルート表）

### Step 3: 印刷ボタンとモーダルの追加
1. `App.jsx` に印刷ボタンを追加
2. 印刷オプションのモーダルコンポーネントを作成
3. 選択された内容に応じて印刷用コンポーネントを表示

### Step 4: 印刷プレビュー機能の実装
1. 印刷プレビュー用のルートを作成
2. 選択された内容を新しいウィンドウで表示
3. 印刷用スタイルを適用

## データ構造

### 印刷設定の状態管理

```javascript
const [printSettings, setPrintSettings] = useState({
  includePlanTable: true,      // 送迎計画表を含める
  includeInstructions: true,   // 運行指示書を含める
  includeRouteMap: true,       // 地図付きルート表を含める
  selectedVehicles: ['all'],   // 対象車両（'all' または車両IDの配列）
  selectedDate: '2025-10-26',  // 対象日付
  selectedDay: '月曜日'         // 対象曜日
})
```

## UI/UXの考慮事項

### 1. 印刷ボタンの配置
- 目立つ位置に配置（全体ビューの上部）
- アイコンとテキストで分かりやすく表示
- 印刷可能な状態（データが存在する）のみ有効化

### 2. 印刷プレビュー
- 実際の印刷結果に近い表示
- ページ区切りを視覚的に表示
- 印刷前に内容を確認できる

### 3. エラーハンドリング
- データが存在しない場合の警告
- 印刷に失敗した場合のエラーメッセージ
- ブラウザの印刷機能がサポートされていない場合の対応

## 今後の拡張機能（Phase 2）

### 1. PDF出力
- jsPDFライブラリを使用してPDFを生成
- ブラウザの印刷機能に依存しない
- ファイル名を自動生成（例: 送迎計画_2025-10-26.pdf）

### 2. Excel出力
- SheetJSライブラリを使用してExcelファイルを生成
- データを編集可能な形式で出力
- 複数のシートに分けて出力（車両ごと、便ごと）

### 3. カスタマイズ可能なテンプレート
- 施設ごとにフォーマットを調整
- ロゴや施設名を追加
- フォントサイズや色のカスタマイズ

## まとめ

この設計に基づいて、実務で使用できる印刷・出力機能を実装します。Phase 1では基本的な印刷機能を実装し、Phase 2でPDF出力やExcel出力などの高度な機能を追加します。

