# 利用者マスタ同期機能のテスト結果

## テスト日時
2025年11月3日

## テストシナリオ
1. 利用者マスタに「冬木 太郎」を月曜日・土曜日で登録
2. 送迎計画画面で各曜日タブを確認
3. 「利用者マスタから同期」ボタンをクリック
4. 「自動割り当て」ボタンをクリック
5. 「全リセット」ボタンをクリック

## テスト結果

### 1. 初期状態（利用者登録後）
- **月曜日タブ**: 30名（サンプルデータのみ）
- **土曜日タブ**: 0名
- **未割り当て（月曜日）**: 1名（「本番テスト 太郎」のみ）
- **未割り当て（土曜日）**: 1名（「冬木 太郎」）

**問題点**: 
- 「冬木 太郎」が月曜日の未割り当てリストに表示されない
- 月曜日タブの人数が30名のまま（32名になるべき）
- 土曜日タブの人数が0名のまま（1名になるべき）

### 2. 曜日タブ切り替え後
- 土曜日→月曜日に切り替えると「冬木 太郎」が自動的に表示される
- **未割り当て（月曜日）**: 2名（「本番テスト 太郎」「冬木 太郎」）
- しかし、月曜日タブの人数は依然として30名のまま

**問題点**:
- 曜日タブの人数カウントが更新されない

### 3. 「自動割り当て」クリック後
- **未割り当て**: 0名（すべて消えた）
- **送迎車1号**: 2/8（2名のみ割り当て）
- メッセージ: 「すべての利用者が割り当てられました」

**重大な問題**:
- 新規登録した利用者（「本番テスト 太郎」「冬木 太郎」）が完全に消えた
- サンプルデータの30名も送迎車に割り当てられていない（2名のみ）
- 月曜日タブの人数は依然として30名のまま

### 4. 「全リセット」クリック後
- **未割り当て**: 30名（サンプルデータのみ）
- 新規登録した利用者が完全に消えた

**重大な問題**:
- 全リセットがサンプルデータのみを復元している
- 利用者マスタから同期した新規利用者が消えてしまう

### 5. 「利用者マスタから同期」クリック後
- **未割り当て**: 32名（サンプルデータ30名 + 新規2名）
- 新規利用者が再度表示される
- しかし、月曜日タブの人数は依然として30名のまま

## 問題の根本原因

システムには**2つの異なるデータソース**があり、それらが適切に統合されていない：

1. **サンプルデータ**（ハードコードされた30名）
2. **利用者マスタデータ**（新規登録した利用者）

### 具体的な問題点

1. **曜日タブの人数カウント**
   - サンプルデータのみをカウントしている
   - 利用者マスタから同期した新規利用者がカウントに含まれていない

2. **全リセット機能**
   - サンプルデータのみを復元している
   - 利用者マスタから同期した新規利用者が消えてしまう

3. **自動割り当て機能**
   - 新規登録した利用者が消えてしまう
   - サンプルデータも正しく割り当てられていない

## 修正が必要な箇所

### App.jsx

1. **曜日タブの人数カウント**
   - サンプルデータと利用者マスタデータの両方をカウントする必要がある
   - 現在はサンプルデータのみをカウントしている

2. **全リセット機能**
   - サンプルデータと利用者マスタデータの両方を復元する必要がある
   - 現在はサンプルデータのみを復元している

3. **自動割り当て機能**
   - サンプルデータと利用者マスタデータの両方を正しく割り当てる必要がある
   - 現在は新規利用者が消えてしまう

## 次のステップ

1. App.jsxのコードを確認し、データ統合の問題を特定する
2. 曜日タブの人数カウントロジックを修正する
3. 全リセット機能を修正する
4. 自動割り当て機能を修正する
5. ローカル環境でテストする
6. 本番環境にデプロイする

