# 本番環境 送迎計画機能 動作確認レポート

**確認日時:** 2025年11月2日 03:34 (JST)  
**環境:** https://transport-web-ten.vercel.app/  
**目的:** 送迎計画を効率的に立てられるか実用性を確認

---

## 確認した機能

### ✅ 正常に動作している機能

1. **曜日選択**
   - 月曜日〜日曜日の選択が可能
   - 各曜日の利用者数が表示される（例: 月曜日30名）

2. **自動割り当て機能**
   - ボタンをクリックすると、30名の利用者が5台の送迎車に自動的に割り当てられる
   - 車椅子対応の考慮がされている
   - 定員を超えない配分になっている
   - 結果: 
     - 送迎車1号: 8/8名、3/2台（車椅子）
     - 送迎車2号: 6/6名、1/1台（車椅子）
     - 送迎車3号: 5/8名、1/2台（車椅子）
     - 送迎車4号: 7/7名、2/1台（車椅子）
     - 送迎車5号: 4/6名、1/1台（車椅子）

3. **ルート最適化機能**
   - 各送迎車のルートを最適化できる
   - 最適化後、距離と時間が計算される
   - 例: 第1便 7名 / 距離: 10.79 km / 時間: 54分

4. **複数便の管理**
   - 第1便、第2便など複数の便を管理できる
   - 各便ごとに距離と時間が表示される

5. **利用者情報の表示**
   - 利用者名、住所、送迎時刻が表示される
   - 車椅子対応、特記事項（認知症あり、玄関まで介助必要など）が表示される
   - 固定アイコンで順番固定の状態が視覚的にわかる

6. **タブビュー/全体ビュー**
   - 送迎車ごとのタブ表示と全体表示の切り替えが可能

7. **印刷機能**
   - QRコードボタンと印刷ボタンが表示されている

8. **全ルート最適化**
   - すべての送迎車のルートを一括で最適化できる

9. **全固定/全解除/全リセット**
   - 一括操作ボタンが用意されている

---

## 実用性の評価

### ✅ 優れている点

1. **自動割り当ての精度**
   - 車椅子対応を考慮した割り当てができている
   - 定員を超えない配分になっている
   - ワンクリックで30名を5台に割り当てられる

2. **ルート最適化の実用性**
   - 距離と時間が自動計算される
   - 最適化により効率的なルートが提案される

3. **視覚的なわかりやすさ**
   - 利用者カードが色分けされている
   - 車椅子アイコン、固定アイコンなどが表示される
   - 特記事項が黄色で強調表示される

4. **操作の簡便性**
   - ドラッグ&ドロップで手動調整も可能
   - 一括操作ボタンで効率的に作業できる

---

## 実用上の課題と改善提案

### 🔧 改善が必要な点

#### 1. **利用者管理との連携**

**現状の問題:**
- 利用者管理画面で新規登録した利用者が、送迎計画画面に自動的に反映されない
- サンプルデータ（weeklyData.js）が固定で表示されている

**影響:**
- 実際の利用者を登録しても送迎計画に使えない
- **今すぐ使える状態ではない**

**解決策:**
1. 利用者管理画面（UserManagement）で登録したデータをlocalStorageに保存
2. 送迎計画画面（App.jsx）でlocalStorageから利用者データを読み込む
3. weeklyData.jsのサンプルデータは初期データとして使用し、利用者管理で上書き可能にする

#### 2. **曜日ごとの利用者データ管理**

**現状の問題:**
- 利用者管理画面で「利用曜日」を設定できるが、送迎計画画面に反映されない
- 各曜日のデータが固定されている

**解決策:**
1. 利用者データに`days_of_week`フィールドを持たせる
2. 送迎計画画面で選択した曜日に応じて、該当する利用者のみ表示する
3. 曜日ごとのフィルタリング機能を実装する

#### 3. **データの永続化**

**現状の問題:**
- 送迎計画の割り当て結果がページをリロードすると消える
- 作業途中の状態を保存できない

**解決策:**
1. 送迎計画の状態（割り当て、ルート、固定状態など）をlocalStorageに保存
2. 曜日ごとに別々に保存する
3. 「保存」ボタンを追加して明示的に保存できるようにする

#### 4. **欠席管理との連携**

**現状の問題:**
- 欠席チェックボックスはあるが、欠席状態が保存されない
- 欠席者を除外した計画が立てられない

**解決策:**
1. 欠席状態をlocalStorageに保存
2. 欠席者を自動的に未割り当てリストから除外
3. 欠席者リストを別途表示する

#### 5. **印刷機能の実用性**

**現状:**
- 印刷ボタンは表示されているが、実際の印刷レイアウトを確認する必要がある

**確認事項:**
- ドライバー向けの運行指示書が印刷できるか
- 送迎計画表が印刷できるか
- 印刷レイアウトが実用的か

---

## 優先度別の対応リスト

### 🔴 最優先（今すぐ使えるようにするために必須）

1. **利用者管理と送迎計画の連携**
   - 利用者管理で登録したデータが送迎計画に反映される
   - 曜日ごとの利用者フィルタリング

2. **送迎計画の状態保存**
   - 割り当て結果の保存
   - ページリロード後も状態が復元される

### 🟡 重要（実用性を高めるために必要）

3. **欠席管理機能**
   - 欠席者の除外
   - 欠席状態の保存

4. **印刷機能の確認と改善**
   - 実際の印刷レイアウトの確認
   - 必要に応じて調整

### 🟢 将来的な改善

5. **データのエクスポート/インポート**
   - CSV/JSONでのデータ管理
   - バックアップ機能

6. **利用実績の自動記録**
   - 送迎計画から利用実績への自動転記

---

## 結論

**現状:** 送迎計画の基本機能（自動割り当て、ルート最適化、複数便管理）は正常に動作しており、UIも優れている。

**課題:** 利用者管理との連携が不足しているため、**実際の利用者データを使った送迎計画が立てられない**。これが「今すぐ使える」状態への最大の障壁。

**次のステップ:** 
1. 利用者管理と送迎計画の連携を実装
2. 送迎計画の状態保存機能を実装
3. 実際のデータで動作確認

これらを実装すれば、実用レベルで「今すぐ使える」送迎計画システムになる。

