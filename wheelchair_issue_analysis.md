# 車椅子利用者の割り当て問題の分析

## 現状の確認

### 月曜日のデータ
- **車椅子利用者数**: 13名
- **一般利用者数**: 17名（30名 - 13名）

### 車両の車椅子定員（全5台）
| 車両 | 総定員 | 車椅子定員 |
|------|--------|------------|
| 1号車 | 8名 | 2名 |
| 2号車 | 6名 | 1名 |
| 3号車 | 8名 | 2名 |
| 4号車 | 7名 | 1名 |
| 5号車 | 6名 | 1名 |
| **合計** | **35名** | **7名** |

## 問題点

### 1便のみの場合
- 全車両を使っても、車椅子定員は **7名** しかない
- 車椅子利用者は **13名** いる
- **6名の車椅子利用者が割り当てられない**

### 現在のロジックの問題
現在の自動割り当てロジックは、以下の順序で動作しています：

```javascript
for (let tripIndex = 0; tripIndex < tripsNeeded; tripIndex++) {
  activeVehicles.forEach(vehicle => {
    // 車椅子ユーザーを割り当て
    while (wheelchairUsers.length > 0 && wheelchairAssigned < vehicle.wheelchairCapacity) {
      // 割り当て処理
    }
    // 一般ユーザーを割り当て
    while (regularUsers.length > 0 && tripUsers.length < vehicle.capacity) {
      // 割り当て処理
    }
  })
}
```

**問題**: 
- 各便で車椅子定員を超えた車椅子利用者は、次の便に回されるべきだが、現在のロジックでは車両ごとに処理しているため、全車両の車椅子定員を使い切った後に次の便に進む仕組みになっていない
- 結果として、車椅子利用者が未割り当てに残る

## 解決策

### 修正案1: 車椅子利用者を優先的に複数便に分散
1. 全車椅子利用者を便ごとに分散させる
2. 各便で、全車両の車椅子定員を最大限活用する
3. 車椅子定員を使い切ったら次の便へ

### 修正案2: より賢い割り当てアルゴリズム
1. 車椅子利用者の総数と、各便で割り当て可能な車椅子定員を計算
2. 必要な便数を算出（車椅子利用者数 ÷ 1便あたりの車椅子定員）
3. 各便に均等に車椅子利用者を配分

## 実装方針

**修正案2を採用**し、以下のロジックに変更：

1. 車椅子利用者の必要便数を計算
2. 一般利用者の必要便数を計算
3. 両者の最大値を必要便数とする
4. 各便で車椅子利用者を優先的に割り当て、残りの定員に一般利用者を割り当て

